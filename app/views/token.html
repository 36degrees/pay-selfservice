{{< layout}}

{{$pageTitle}}
List of developer tokens
{{/pageTitle}}

{{$content}}

<script type="text/javascript">
    $(document).ready(function(){

        var descriptionBeforeEditing = {};

        $("a[id$='-edit']").click(function(event){
            var tokenLink = event.target.id.slice(0,36);
            var editLinkSelector = 'a#' + tokenLink + '-edit';
            var descriptionDivSelector = 'div#' + tokenLink + '-description';
            var cancelLinkSelector = 'a#' + tokenLink + '-cancel';
            var saveButtonSelector = 'input#' + tokenLink + '-save';
            var revokeLinkSelector = 'a#' + tokenLink + '-revoke';
            var revokeMessageDivSelector = 'div#' + tokenLink + '-revoke-message';

            descriptionBeforeEditing[tokenLink] = $(descriptionDivSelector).text();
            $(descriptionDivSelector).replaceWith("<input id='" + tokenLink + "-input' type='text' value='" + descriptionBeforeEditing[tokenLink] + "' style='display: block' />");

            $(revokeLinkSelector).hide();
            $(revokeMessageDivSelector).hide();
            $(editLinkSelector).hide();
            $(cancelLinkSelector).show();
            $(saveButtonSelector).show();
        });

        $("a[id$='-cancel']").click(function(event){
            var tokenLink = event.target.id.slice(0,36);
            var cancelLinkSelector = 'a#' + tokenLink + '-cancel';
            var inputSelector = 'input#' + tokenLink + '-input';
            var editLinkSelector = 'a#' + tokenLink + '-edit';
            var saveButtonSelector = 'input#' + tokenLink + '-save';
            var revokeLinkSelector = 'a#' + tokenLink + '-revoke';

            $(inputSelector).replaceWith("<div id='" + tokenLink + "-description'><b>" + descriptionBeforeEditing[tokenLink] + "</b></div>");

            $(cancelLinkSelector).hide();
            $(saveButtonSelector).hide();
            $(editLinkSelector).show();
            $(revokeLinkSelector).show();
        });

        $("input[id$='-save']").click(function(event){
            var tokenLink = event.target.id.slice(0,36);
            var saveButtonSelector = 'input#' + tokenLink + '-save';
            var inputSelector = 'input#' + tokenLink + '-input';
            var editLinkSelector = 'a#' + tokenLink + '-edit';
            var cancelLinkSelector = 'a#' + tokenLink + '-cancel';
            var newDescription = $(inputSelector).val();
            var revokeLinkSelector = 'a#' + tokenLink + '-revoke';

            $.ajax({
                type: 'PUT',
                url: '/tokens',
                data: {
                    'token_link': tokenLink,
                    'description': newDescription
                },
                dataType : 'json',
                success: function(responseData){
                    $(inputSelector).replaceWith("<div id='" + tokenLink + "-description'><b>" + newDescription + "</b></div>");
                },
                error: function(xhr, status) {
                    $(inputSelector).replaceWith("<div id='" + tokenLink + "-description'><b>" + descriptionBeforeEditing[tokenLink] + "</b></div>");
                },
                complete : function(xhr, status) {
                    $(saveButtonSelector).hide();
                    $(cancelLinkSelector).hide();
                    $(editLinkSelector).show();
                    $(revokeLinkSelector).show();
                }
            });
        });

        $("a[id$='-revoke']").click(function(event){
            var tokenLink = event.target.id.slice(0,36);
            var revokeMessageDivSelector = 'div#' + tokenLink + '-revoke-message';
            $(revokeMessageDivSelector).show();
        });

        $("input[id$='-revoke-no']").click(function(event){
            var tokenLink = event.target.id.slice(0,36);
            var revokeMessageDivSelector = 'div#' + tokenLink + '-revoke-message';
            $(revokeMessageDivSelector).hide();
        });

        $("input[id$='-revoke-yes']").click(function(event){
            var tokenLink = event.target.id.slice(0,36);
            var revokeMessageDivSelector = 'div#' + tokenLink + '-revoke-message';
            var editLinkSelector = 'a#' + tokenLink + '-edit';
            var revokeLinkSelector = 'a#' + tokenLink + '-revoke';
            var revokedDivSelector = 'div#' + tokenLink + '-revoked';
            var revokedDateSpanSelector = 'span#' + tokenLink + '-revoked-date';
            $.ajax({
                type: 'DELETE',
                url: '/tokens/revoke/{{account_id}}',
                data: {
                    'token_link': tokenLink,
                },
                success: function(responseData){
                    $(revokedDateSpanSelector).text(responseData.revoked);
                    $(revokeMessageDivSelector).hide();
                    $(editLinkSelector).hide();
                    $(revokeLinkSelector).hide();
                    $(revokedDivSelector).show();
                },
                error: function(xhr, status) {
                    $(revokeMessageDivSelector).hide();
                }
            });
        });

    });
</script>

<main id="content" role="main">

    <h1>Developer keys</h1>
    <hr />

    {{^tokens.length}}
        <h2>{{header2}}</h2>
        <a id="generateLink" href="/tokens/generate/{{account_id}}">
            <input id="generateButton" type="button" value="Generate a new key" />
        </a>
        <hr />
    {{/tokens.length}}

    {{#tokens.length}}

        <h2>{{header2}}</h2>

        <a id="generateLink" href="/tokens/generate/{{account_id}}">
            <input id="generateButton" type="button" value="Generate a new key" />
        </a>

        <h3>Active keys</h3>
        <hr />

        {{#tokens}}
            {{#revoked}}
                <div id="{{token_link}}-description"><b>{{description}}</b></div>
                <div id="{{token_link}}-revoked">This key was successfully revoked on {{revoked}}. It will no longer enable integration with the platform.</div>
            {{/revoked}}

            {{^revoked}}
                <div id="{{token_link}}-description"><b>{{description}}</b></div>
                <a id="{{token_link}}-edit">Edit description</a>
                <input id="{{token_link}}-save" type="button" style="display: none" value="Save changes" />
                <a id="{{token_link}}-cancel" style="display: none">cancel</a>
                <a id="{{token_link}}-revoke">Revoke key</a>
                <div id="{{token_link}}-revoke-message" style="display: none">
                    Are you sure you want to revoke this developer key?
                    If revoked it will no longer enable integration with the platform.
                    <input id="{{token_link}}-revoke-yes" type="button" value="Yes" />
                    <input id="{{token_link}}-revoke-no" type="button" value="No" />
                </div>
                <div id="{{token_link}}-revoked" style="display: none">
                    This key was successfully revoked on <span id="{{token_link}}-revoked-date"></span>.
                    It will no longer enable integration with the platform.
                </div>
            {{/revoked}}
            <hr />
        {{/tokens}}

    {{/tokens.length}}

</main>

{{/content}}

{{/layout}}

{% extends "../layout-new.njk" %}
{% from "components/input/macro.njk" import govukInput %}
{% from "components/radios/macro.njk" import govukRadios %}
{% from "components/button/macro.njk" import govukButton %}

{% block pageTitle %}
  Create a payment link - {{currentService.name}} {{currentGatewayAccount.full_type}} - GOV.UK Pay
{% endblock %}

{% block side_navigation %}
  {% set createLink = true %}
  {% include "./_nav.njk" %} 
{% endblock %}

{% block mainContent %}
<section class="govuk-grid-column-two-thirds govuk-!-margin-top-6">
  <form action="{{ routes.paymentLinks.reference }}" class="form" method="post" data-validate>
    <input id="csrf" name="csrfToken" type="hidden" value="{{csrf}}"/>
    {% if change.length %}
      <input name="change" type="hidden" value="true"/>
    {% endif %}

    {% set noSelectionError = false %}
    {% if flash.errorType[0] === "paymentReferenceType" %}
    {% set noSelectionError = {
        text: "Please choose an option"
    } %}
    {% endif %}

    {% set blankReferenceLabelError = false %}
    {% if flash.errorType[0] === "label" %}
    {% set blankReferenceLabelError = {
        text: "Reference number cannot be blank"
    } %}
    {% endif %}

    {% set customReferenceHTML %}
      {{
        govukInput({
          id: "reference-label",
          name: "reference-label",
          value: paymentReferenceLabel,
          errorMessage: blankReferenceLabelError,
          classes: "govuk-input--width-20",
          label: {
              text: "Name of your payment reference number",
              classes: "govuk-label--s"
          },
          hint: {
            text: "Choose the name of what you would like to collect from your users. For example, ‘Reference number’ or ‘Invoice number’."
          },
          attributes: {
            "data-validate": "isNaxsiSafe"
          }
        })
      }}

      {{
        govukInput({
          id: "reference-hint-text",
          name: "reference-hint-text",
          value: paymentReferenceHint,
          classes: "govuk-input--width-20",
          label: {
              text: "Hint text (optional)",
              classes: "govuk-label--s"
          },
          hint: {
            text: "Give your users more information. For example, you could tell them where to find the invoice number."
          },
          attributes: {
            "data-validate": "isFieldGreaterThanMaxLengthChars isNaxsiSafe",
            "maxlength": "255",
            "data-validate-max-length": "255"
          }
        })
      }}
      <p class="govuk-body govuk-!-font-size-16 govuk-text-grey">255 characters</p>
    {% endset %}
    {{
      govukRadios({
        idPrefix: "reference-type-group",
        name: "reference-type-group",
        fieldset: {
            legend: {
                text: "Would you like us to create a payment reference number for your users?",
                isPageHeading: true,
                classes: "govuk-fieldset__legend--l"
            }
        },
        errorMessage: noSelectionError,
        items: [
          {
              value: "standard",
              text: "Yes, create a unique payment reference number for my users",
              checked: paymentReferenceType === 'standard',
              attributes: {
                id: "reference-type-standard"
              }
          },
          {
              value: "custom",
              text: "No, I would like to use my own",
              checked: paymentReferenceType === 'custom' or blankReferenceLabelError,
              attributes: {
                id: "reference-type-custom"
              },
              conditional: {
                html: customReferenceHTML
              }
          }
        ]
      })
    }}

    {{
      govukButton({
        text: "Continue"
      })
    }}
    <p class="govuk-body"><a class="govuk-link govuk-link--no-visited-state cancel" href="{{ routes.paymentLinks.start }}">Cancel</a></p>
  </form>
  <div class="govuk-!-margin-top-9">
    <h3 class="govuk-heading-s">Example of what the user will see</h3>
    <img src="/public/images/adhoc-1-start.svg" alt="Screenshot of a payment link page showing a input for the user to enter a reference">
  </div>
</section>
{% endblock %}
